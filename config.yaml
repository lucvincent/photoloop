# Copyright (c) 2025-2026 Luc Vincent. All Rights Reserved.
# ============================================================
#                    PhotoLoop Configuration
# ============================================================
#
# Digital photo frame software for Raspberry Pi.
# Displays photos from Google Photos albums or local directories.
#
# Edit this file directly or use the web dashboard at:
#   http://<raspberry-pi-ip>:8080
#
# After editing, restart PhotoLoop: sudo systemctl restart photoloop
#
# This file is organized to match the dashboard tabs:
#   1. Control   - Sync settings
#   2. Albums    - Photo sources (Google Photos, local folders)
#   3. Display   - Slideshow appearance, scaling, overlays
#   4. Screensaver - Schedule and display modes
#   5. Clock     - Clock display, weather, news ticker
#   6. Cache     - Photo storage settings
#
# ============================================================


# ############################################################
#                    WEB DASHBOARD
# ############################################################
# PhotoLoop includes a web dashboard for configuration and control.
#
# Accessing the dashboard:
#   - From any device on your network: http://<pi-ip>:8080
#   - Find your Pi's IP: hostname -I
#   - Works on desktop browsers, tablets, and phones
#   - Add to phone home screen for app-like experience (PWA)
#
# Dashboard features:
#   - Configure all settings below via a visual interface
#   - Control slideshow (start/stop/next/previous)
#   - View current photo and cache statistics
#   - Trigger album sync manually
#
web:
  enabled: true                          # Enable web dashboard
  port: 8080                             # HTTP port
  host: "0.0.0.0"                        # 0.0.0.0 = network, 127.0.0.1 = local only


# ############################################################
#                     1. CONTROL
# ############################################################
# Sync settings for downloading photos from albums.

# ------------------------------------------------------------
# Sync Settings (Dashboard: Control tab)
# ------------------------------------------------------------
# How often to check for new photos in albums.
#
# interval_minutes: How often to sync (1440 = daily, 0 = manual only)
# sync_time:        Time for first sync (24h format), then every interval
# sync_on_start:    Sync immediately on service start
# max_dimension:    Maximum image dimension (width or height) in pixels
#                   0 = download original full resolution (recommended for 4K)
#                   1920 = limit to 1920px on longest edge (saves bandwidth/storage)
#
# Sync behavior:
# - If interval_minutes is 0, only manual syncs run (via dashboard or CLI)
# - If sync_time is set, first scheduled sync happens at that time
# - sync_on_start is independent of sync_time
# - Only enabled albums (marked "Show" in Albums tab) are synced
#
# Examples:
# - Sync daily at 3am: sync_time: "03:00", interval_minutes: 1440
# - Sync hourly starting at midnight: sync_time: "00:00", interval_minutes: 60
# - Sync every 6 hours from service start: omit sync_time, interval_minutes: 360
# - Manual sync only: interval_minutes: 0
#
sync:
  interval_minutes: 1440               # 0 = manual only, 1440 = daily, etc.
  sync_time: "03:00"
  sync_on_start: false
  max_dimension: 0                     # 0 = full resolution, or max pixels (e.g., 1920)


# ############################################################
#                     2. ALBUMS
# ############################################################
# Configure photo sources: Google Photos albums and local directories.

# ------------------------------------------------------------
# Albums - Photo sources to display
# ------------------------------------------------------------
# Add public Google Photos albums or local directories.
#
# Google Photos: Use the sharing link (photos.app.goo.gl/...)
# To make an album public:
#   1. Open Google Photos and go to the album
#   2. Click Share > Get link
#   3. Set "Link sharing" to ON
#   4. Copy the link and paste below
#
# Local directories: Use 'path' instead of 'url', set type: local
#
# Fields:
#   url:     Google Photos sharing URL (for google_photos type)
#   path:    Local directory path (for local type)
#   name:    Display name shown in dashboard and logs
#   type:    "google_photos" or "local" (auto-detected if omitted)
#   enabled: true/false - whether to include in slideshow
#
albums:
  - url: "https://photos.app.goo.gl/YOUR_ALBUM_URL_HERE"
    name: "My Photos"
    enabled: true
    type: google_photos
  # Add more albums:
  # - url: "https://photos.app.goo.gl/ANOTHER_ALBUM"
  #   name: "Vacation 2024"
  #   enabled: true
  #   type: google_photos
  # - path: "/home/pi/photos"
  #   name: "Local Photos"
  #   enabled: true
  #   type: local

# ------------------------------------------------------------
# Local Albums Browser (Dashboard: Albums tab)
# ------------------------------------------------------------
# Control directory browsing in the web UI.
#
# enabled:          Allow adding local directories via dashboard
# browse_paths:     List of paths users can browse (security restriction)
# show_photo_counts: Count images per directory (slower but informative)
#
# Security notes:
# - Set enabled: false to completely disable local directory support
# - browse_paths restricts which directories users can browse via the web UI
# - Hidden directories (starting with '.') are never shown
# - Only directories within browse_paths can be selected
#
# Note: Photo counts show files in that directory only, not subdirectories.
# However, when added as an album, all subdirectories ARE scanned recursively.
#
local_albums:
  enabled: true
  browse_paths: ["/home", "/media", "/mnt"]
  show_photo_counts: true

# ############################################################
#                     3. DISPLAY
# ############################################################
# Slideshow appearance: timing, transitions, scaling, overlays.

# ------------------------------------------------------------
# Display Settings (Dashboard: Display tab)
# ------------------------------------------------------------
# resolution:              "auto" detects screen, or specify "1920x1080", "3840x2160"
# photo_duration_seconds:  How long each photo is shown
# video_enabled:           Include videos in slideshow (requires ffpyplayer)
#
# Transition settings:
# transition_type:         fade, slide_left, slide_right, slide_up, slide_down, random
# transition_duration_ms:  Transition length in milliseconds
#
# Photo order options:
# - random:           Shuffled order, re-shuffled each time playlist loops
# - recency_weighted: Random with recency bias - recent photos appear more often
# - alphabetical:     Sorted by filename (case-insensitive)
# - chronological:    Sorted by date (oldest first)
#
# Recency-weighted settings (when order: "recency_weighted"):
# recency_cutoff_years: Photos older than this get minimum weight
# recency_min_weight:   Weight for old photos (0.33 = 1/3 as likely as new photos)
#
# Weight formula: Linear decay from 1.0 (today) to recency_min_weight (at cutoff).
# Photos older than cutoff all have recency_min_weight. Every photo still appears
# once per cycle, but recent photos tend to appear earlier in the shuffled order.
#
# Date priority (for chronological and recency_weighted modes):
# 1. EXIF date (embedded in photo metadata)
# 2. Google Photos date (scraped from album)
# 3. File modification time (fallback if no date metadata)
#
# Display power control for off-hours:
# power_control: auto, wlopm (Wayland), cec (HDMI-CEC for TVs), none
#
display:
  resolution: "auto"                   # "auto" or "1920x1080" or "3840x2160"
  photo_duration_seconds: 30           # Seconds per photo
  video_enabled: true                  # Include videos in slideshow
  transition_type: "fade"              # fade, slide_left/right/up/down, random
  transition_duration_ms: 1000         # Transition length in milliseconds
  order: "random"                      # random, recency_weighted, alphabetical, chronological
  recency_cutoff_years: 5.0            # For recency_weighted: age for minimum weight
  recency_min_weight: 0.33             # For recency_weighted: weight at cutoff (0.33 = 1/3)
  power_control: "auto"                # auto, wlopm, cec, none

# ------------------------------------------------------------
# Scaling and Cropping (Dashboard: Display tab)
# ------------------------------------------------------------
# How photos fit the screen when aspect ratios don't match.
#
# mode:             How photos fit the screen
#   - fill:         Crop to fill screen (may cut edges)
#   - fit:          Show entire photo with black bars (letterbox/pillarbox)
#   - balanced:     Compromise - crop up to max_crop_percent, then add bars
#   - stretch:      Distort to fill (not recommended)
#
# max_crop_percent: For balanced mode: max crop before adding bars
# background_color: RGB color for letterbox/pillarbox bars [R, G, B]
#
# Smart cropping - find the best region to show when cropping:
# smart_crop:        Enable intelligent crop region selection
# smart_crop_method: face (detect faces), saliency (detect interesting areas), hybrid
#
# Face detection settings:
# face_detection:  Enable face detection for smart cropping
# face_position:   Where to position detected faces
#   - center:         Center faces in frame
#   - rule_of_thirds: Position faces at rule-of-thirds intersection
#   - top_third:      Position faces in upper third
#
# Fallback when no faces found:
# fallback_crop: center, top, bottom
# crop_bias:     none, top, bottom (bias direction when cropping)
#
# Saliency detection settings (when smart_crop_method includes saliency):
# saliency_threshold: Minimum saliency score (0.0-1.0)
# saliency_coverage:  Target coverage of salient regions (0.0-1.0)
#
scaling:
  mode: "fill"                         # fill, fit, balanced, stretch
  max_crop_percent: 15                 # For balanced: max crop before adding bars
  background_color: [0, 0, 0]          # RGB for letterbox/pillarbox bars
  smart_crop: true                     # Enable intelligent crop region selection
  smart_crop_method: "face"            # face, saliency, hybrid
  face_detection: true                 # Enable face detection
  face_position: "center"              # center, rule_of_thirds, top_third
  fallback_crop: "center"              # center, top, bottom (when no faces)
  crop_bias: "none"                    # none, top, bottom
  saliency_threshold: 0.3              # 0.0-1.0
  saliency_coverage: 0.9               # 0.0-1.0

# ------------------------------------------------------------
# Ken Burns Effect (Experimental)
# ------------------------------------------------------------
# Slow zoom/pan during photo display for a cinematic effect.
#
# WARNING: This feature is experimental with known issues:
# - Stretched images during transitions
# - Panoramas don't work well (shows small vertical slice)
# - May have aliasing artifacts during animation
# Disabled by default. Enable at your own risk.
#
# enabled:    Enable Ken Burns effect
# zoom_range: [min, max] zoom levels (1.0 = no zoom, 1.15 = 15% zoom)
# pan_speed:  Movement speed for panning
# randomize:  Vary zoom/pan direction randomly
#
ken_burns:
  enabled: false
  zoom_range: [1.0, 1.15]
  pan_speed: 0.02
  randomize: true

# ------------------------------------------------------------
# Overlay Settings (Dashboard: Display tab)
# ------------------------------------------------------------
# Photo date and caption display overlaid on photos.
#
# enabled:      Show overlay on photos
# show_date:    Display photo date
# show_caption: Display photo caption/description
#
# date_format:  Python strftime format string
#               %B = full month, %d = day, %Y = year
#               Examples: "%B %d, %Y" -> "January 15, 2024"
#                         "%Y-%m-%d" -> "2024-01-15"
#
# date_source:  Where to get the date from
#   - exif_first:   Try EXIF metadata first, fall back to Google Photos
#   - google_first: Try Google Photos first, fall back to EXIF
#   - exif_only:    Only use EXIF metadata
#   - google_only:  Only use Google Photos date
#
# position:     Overlay position: bottom_left, bottom_right, top_left, top_right
# font_size:    Text size in pixels
# font_color:   RGB color for text [R, G, B]
# background_color: RGBA for overlay background [R, G, B, A] (A=0-255 for transparency)
# padding:      Pixels of padding around text
# max_caption_length: Truncate captions longer than this
#
# Caption source priorities (lower number = higher priority):
# caption_sources:
#   google_caption:   Caption from Google Photos
#   embedded_caption: Caption embedded in image metadata (EXIF/IPTC)
#   google_location:  Location from Google Photos
#   exif_location:    Location from EXIF GPS coordinates (reverse geocoded)
#
# max_caption_sources: How many caption sources to combine
# caption_separator:   Text between combined caption sources
#
overlay:
  enabled: true                        # Show overlay on photos
  show_date: true                      # Display photo date
  show_caption: true                   # Display photo caption
  date_format: "%B %d, %Y"             # strftime format (January 15, 2024)
  date_source: "exif_first"            # exif_first, google_first, exif_only, google_only
  position: "bottom_left"              # bottom_left/right, top_left/right
  font_size: 24                        # Text size in pixels
  font_color: [255, 255, 255]          # RGB white
  background_color: [0, 0, 0, 128]     # RGBA semi-transparent black
  padding: 20                          # Pixels around text
  max_caption_length: 200              # Truncate longer captions
  caption_sources:                     # Priority order (lower = higher priority)
    google_caption: 1
    embedded_caption: 2
    google_location: 3
    exif_location: 4
  max_caption_sources: 1               # How many sources to combine
  caption_separator: " â€” "             # Between combined sources

# --------------------------------------
# Text Classification
# --------------------------------------
# Classifies Google Photos DOM text (captions vs locations vs camera info)
# using pattern-based heuristics at display time.
#
# ARCHITECTURE: "Dumb scraper, smart display"
#   1. Scraper extracts ALL text from Google Photos without classifying
#   2. Raw text stored in google_raw_texts field (survives re-scraping)
#   3. At display time, heuristics classify text as:
#      - location: Geographic places ("Barcelona, Spain", "Wyoming")
#      - caption: User descriptions ("Family dinner at grandma's")
#      - camera_info: Device/settings ("RICOH IMAGING COMPANY", "ISO 400")
#      - ui_artifact: Google UI text ("Add description", "Details")
#   4. Results cached to disk - classification runs once per unique text
#
# WHY HEURISTICS: We tested Ollama/tinyllama LLM but it performed poorly
# (classified everything as "location"). Heuristics are instant, accurate,
# and require no additional dependencies or RAM.
#
# CLI: Use `photoloop reclassify` to clear cached classifications and
# force re-classification on next display (useful if heuristics are updated).
#
# FUTURE: The caching infrastructure supports more expensive classifiers
# (e.g., web API) if better accuracy is needed later.
#
text_classifier:
  enabled: true                        # Enable classification at display time
  cache_classifications: true          # Cache results to disk (recommended)


# ############################################################
#                   4. SCREENSAVER
# ############################################################
# Schedule when to show slideshow, clock, or turn off display.
# The display can be in one of three modes:
#   - slideshow: Show photos
#   - clock:     Show clock (with optional weather and news)
#   - black:     Turn off display (DPMS standby to save power)

# ------------------------------------------------------------
# Schedule (Dashboard: Screensaver tab)
# ------------------------------------------------------------
# enabled: Enable/disable the schedule (if disabled, slideshow runs continuously)
#
# default_screensaver_mode: What to show when:
#   - User manually stops the slideshow
#   - No photos are available (sync not complete, all albums disabled)
#   Options: "black" (display off) or "clock"
#
# Event-based scheduling:
# Define time periods for weekdays (Mon-Fri) and weekends (Sat-Sun).
# Each event specifies: start_time, end_time, mode
#
# Time format: 'HH:MM' (24-hour, MUST be quoted to avoid YAML parsing issues)
# Use '24:00' for end of day (midnight)
#
# IMPORTANT: Events must:
#   - Cover the full day (00:00 to 24:00)
#   - Not have gaps or overlaps
#   - Have times in quotes to prevent YAML sexagesimal interpretation
#
# Holiday settings:
# use_weekend_schedule: Apply weekend schedule on holidays
# countries:            List of ISO 3166-1 alpha-2 country codes
#
# Available country codes (partial list):
#   Americas: US, CA, MX, BR, AR, CL, CO
#   Europe:   GB, DE, FR, IT, ES, NL, BE, AT, CH, IE, PT, PL, SE, NO, DK, FI
#   Asia:     JP, CN, KR, IN, SG, HK, TW, TH, MY, PH, ID, VN
#   Oceania:  AU, NZ
#   Other:    IL, ZA, EG, RU, UA, TR
#
schedule:
  enabled: true                        # Enable schedule (false = slideshow runs 24/7)
  default_screensaver_mode: "black"    # black or clock

  weekday_events:                      # Monday-Friday schedule
    - start_time: '00:00'
      end_time: '07:00'
      mode: black                      # black, clock, or slideshow
    - start_time: '07:00'
      end_time: '22:00'
      mode: slideshow
    - start_time: '22:00'
      end_time: '24:00'
      mode: black

  weekend_events:                      # Saturday-Sunday schedule
    - start_time: '00:00'
      end_time: '08:00'
      mode: black
    - start_time: '08:00'
      end_time: '23:00'
      mode: slideshow
    - start_time: '23:00'
      end_time: '24:00'
      mode: black

  holidays:
    use_weekend_schedule: false        # Use weekend schedule on holidays
    countries: []                      # e.g., ["US"] or ["US", "FR", "DE"]


# ############################################################
#                      5. CLOCK
# ############################################################
# Clock display shown during scheduled off-hours or when stopped.
# The clock can optionally show weather and scrolling news headlines.

# ------------------------------------------------------------
# Clock Display (Dashboard: Clock tab)
# ------------------------------------------------------------
# style: Clock style options:
#   - digital_24h:     24-hour digital (14:30)
#   - digital_12h:     12-hour digital (2:30 PM)
#   - digital_seconds: With seconds (14:30:45)
#   - digital_large:   Extra large digits
#   - analog_classic:  Traditional analog clock face
#   - analog_modern:   Modern minimalist analog
#   - minimal_time:    Time only, no decoration
#   - minimal_date:    Date only
#
# size:      small, medium, large
# show_date: Show date below/beside time
#
clock:
  style: "digital_24h"                 # digital_24h/12h/seconds/large, analog_classic/modern, minimal_time/date
  size: "medium"                       # small, medium, large
  show_date: true                      # Show date below/beside time

# ------------------------------------------------------------
# Weather Display (Dashboard: Clock tab)
# ------------------------------------------------------------
# Shows current weather next to the clock.
# Uses Open-Meteo API (free, no API key needed).
#
# enabled:                 Show weather on clock screen
# city_name:               Display name only (not used for weather lookup)
# latitude/longitude:      GPS coordinates for weather lookup
#                          Find yours at: https://www.latlong.net/
# units:                   "fahrenheit" or "celsius"
# update_interval_minutes: How often to refresh weather data
# font_size:               Weather text size (0 = auto-scale with clock)
#
weather:
  enabled: false                       # Show weather on clock screen
  city_name: ""                        # Display name (cosmetic only)
  latitude: null                       # GPS latitude (e.g., 37.7749)
  longitude: null                      # GPS longitude (e.g., -122.4194)
  units: "fahrenheit"                  # fahrenheit or celsius
  update_interval_minutes: 30          # How often to refresh
  font_size: 0                         # 0 = auto-scale with clock

# ------------------------------------------------------------
# News Headlines (Dashboard: Clock tab)
# ------------------------------------------------------------
# Scrolling news ticker from RSS feeds shown below the clock.
#
# enabled:                  Show news ticker
# feed_urls:                List of RSS feed URLs
#                           Prefix with "# " to disable a feed
# refresh_interval_minutes: How often to fetch new headlines
# max_headlines:            Maximum headlines to display
# scroll_speed:             Ticker scroll speed in pixels per second
# font_size:                News text size (0 = auto-scale)
#
# Popular RSS feeds (remove "# " prefix to enable):
#   BBC News:      https://feeds.bbci.co.uk/news/rss.xml
#   NPR:           https://feeds.npr.org/1001/rss.xml
#   NY Times:      https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml
#   The Guardian:  https://www.theguardian.com/world/rss
#   Reuters:       https://feeds.reuters.com/reuters/topNews
#   TechCrunch:    https://techcrunch.com/feed/
#   Ars Technica:  https://feeds.arstechnica.com/arstechnica/index
#
news:
  enabled: false                       # Show scrolling news ticker
  feed_urls:                           # RSS feeds (prefix "# " to disable)
    - "# https://feeds.bbci.co.uk/news/rss.xml"
    - "# https://feeds.npr.org/1001/rss.xml"
    - "# https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml"
    - "# https://techcrunch.com/feed/"
  refresh_interval_minutes: 5          # How often to fetch headlines
  max_headlines: 10                    # Max headlines to display
  scroll_speed: 180                    # Pixels per second
  font_size: 0                         # 0 = auto-scale


# ############################################################
#                      6. CACHE
# ############################################################
# Photo storage and caching settings.

# ------------------------------------------------------------
# Cache Settings (Dashboard: Cache tab)
# ------------------------------------------------------------
# directory:   Where to store downloaded photos
# max_size_mb: Maximum cache size in MB
#              When exceeded, oldest soft-deleted photos are removed first
#
# Cache behavior:
# - Photos removed from albums are "soft deleted" (excluded from slideshow)
# - Actual files remain on disk until cache exceeds max_size_mb
# - When limit is exceeded, oldest soft-deleted files are removed first
# - Local directory photos are referenced in-place (not copied to cache)
#
cache:
  directory: "/var/lib/photoloop/cache"  # Where to store downloaded photos
  max_size_mb: 1000                      # Max size in MB (oldest removed when exceeded)

# ------------------------------------------------------------
# Rendered Frame Cache
# ------------------------------------------------------------
# Pre-renders photos at display resolution for instant loading.
# Builds up as you view photos. Safe to clear.
#
# How it works:
# 1. When a photo is displayed, it's cropped/scaled to screen resolution
# 2. The rendered frame is saved as high-quality JPEG to disk
# 3. Next time the same photo is displayed, it loads instantly from cache
# 4. Cache is invalidated per-photo when resolution or crop window changes
#
# enabled:     Enable rendered frame caching
# max_size_mb: Maximum disk space for rendered frames (0 = no limit)
# quality:     JPEG quality for cached frames (70-100, higher = better but larger)
#
# Manual cache management:
#   Check size: du -sh /var/lib/photoloop/cache/rendered/
#   Clear:      rm -rf /var/lib/photoloop/cache/rendered/
#
rendered_cache:
  enabled: true                          # Cache pre-rendered frames
  max_size_mb: 0                         # Max disk space (0 = no limit)
  quality: 95                            # JPEG quality 70-100


# ============================================================
#                     QUICK START GUIDE
# ============================================================
#
# 1. Add your Google Photos album URL above (replace YOUR_ALBUM_URL_HERE)
# 2. Sync photos:     photoloop sync
# 3. Start slideshow: photoloop start
# 4. Open dashboard:  http://<pi-ip>:8080
#
# Commands:
#   photoloop status   - Show current state
#   photoloop start    - Start slideshow
#   photoloop stop     - Stop slideshow
#   photoloop next     - Skip to next photo
#   photoloop sync     - Download new photos
#   photoloop reload   - Reload configuration
#
# Service control:
#   sudo systemctl start photoloop
#   sudo systemctl stop photoloop
#   sudo systemctl restart photoloop
#   sudo journalctl -u photoloop -f   (view logs)
#
# ============================================================
