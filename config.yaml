# Copyright (c) 2025 Luc Vincent. All Rights Reserved.
# ============================================================
# PhotoLoop Configuration
# ============================================================
#
# This file controls all aspects of your PhotoLoop photo frame.
# Edit this file directly or use the web interface at:
#   http://<raspberry-pi-ip>:8080
#
# After editing, restart PhotoLoop or use 'photoloop reload'
# ============================================================

# ------------------------------------------------------------
# Local Albums Settings - Directory browser for local photos
# ------------------------------------------------------------
# Control whether users can add local directories via the web UI
local_albums:
  enabled: true                              # Allow adding local directories
  browse_paths: ["/home", "/media", "/mnt"]  # Paths users can browse
  show_photo_counts: true                    # Show image count (slower browsing)

# ------------------------------------------------------------
# Albums - List of public Google Photos album URLs to display
# ------------------------------------------------------------
# Add one or more public (world-visible) Google Photos albums.
# You can use either the short URL (photos.app.goo.gl/...) or
# the full URL (photos.google.com/share/...)
#
# To make an album public:
#   1. Open Google Photos and go to the album
#   2. Click Share > Get link
#   3. Set "Link sharing" to ON
#   4. Copy the link and paste it below
#
albums:
  - url: "https://photos.app.goo.gl/YOUR_ALBUM_URL_HERE"
    name: "My Photos"    # Optional friendly name (shown in logs/web UI)
  # Add more albums:
  # - url: "https://photos.app.goo.gl/ANOTHER_ALBUM"
  #   name: "Vacation 2024"
  # - url: "https://photos.app.goo.gl/YET_ANOTHER"
  #   name: "Family Events"

# ------------------------------------------------------------
# Sync Settings - How often to check for new photos/videos
# ------------------------------------------------------------
sync:
  # How often to automatically sync albums (in minutes)
  # Default: 1440 (24 hours) - syncing is slow due to caption fetching
  # Set to 0 to disable automatic sync (manual only via web interface or CLI)
  # Tradeoff: More frequent = more up-to-date, but uses more bandwidth/CPU
  interval_minutes: 1440

  # Time of day for scheduled sync (24-hour format HH:MM)
  # The first automatic sync will occur at this time, then every interval_minutes after.
  # If omitted, sync starts interval_minutes after service start.
  # Examples:
  #   "03:00" - Sync at 3 AM (good for overnight updates)
  #   "12:00" - Sync at noon
  sync_time: "03:00"

  # Whether to sync immediately when the service starts
  # true = sync right away on startup (useful after adding new albums)
  # false = wait for scheduled sync time
  # Note: This is independent of sync_time - both can trigger syncs
  sync_on_start: false

  # Download resolution
  # true = original quality (larger files, best quality)
  # false = limit to max_dimension (smaller files, faster downloads)
  # Tradeoff: Full resolution uses more storage but looks better on 4K displays
  full_resolution: true
  max_dimension: 1920        # Max width/height if full_resolution is false
                             # Use 3840 for 4K displays

# ------------------------------------------------------------
# Display Settings - Slideshow appearance and behavior
# ------------------------------------------------------------
display:
  # Resolution: "auto" detects screen size automatically
  # Or specify explicitly: "1920x1080", "3840x2160" (4K), "1280x720"
  resolution: "auto"

  photo_duration_seconds: 30       # How long each photo is shown
  video_enabled: true              # Set to false to skip videos entirely

  # Transition between photos
  # Options: fade, slide_left, slide_right, slide_up, slide_down, random
  transition_type: "fade"
  transition_duration_ms: 1000     # Transition animation length in milliseconds

  # Photo order - how photos are sequenced in the slideshow
  # Options:
  #   "random"           - Shuffled randomly, re-shuffled each cycle
  #   "recency_weighted" - Random with recency bias (recent photos appear more often)
  #   "alphabetical"     - Sorted by filename (case-insensitive)
  #   "chronological"    - Sorted by date (oldest first)
  #
  # Date priority for chronological/recency_weighted:
  #   1. EXIF date (embedded in photo metadata)
  #   2. Google Photos date (scraped from album)
  #   3. File modification time (fallback)
  order: "random"

  # Recency-weighted mode settings (only used when order: "recency_weighted")
  # This mode biases toward showing recent photos more frequently while still
  # ensuring all photos appear at least once per cycle.
  #
  # How it works:
  #   - Photos are weighted by age: newer photos get higher weight
  #   - Weight decays linearly from 1.0 (today) to recency_min_weight (at cutoff)
  #   - Photos older than recency_cutoff_years all have the same minimum weight
  #   - Higher-weighted photos tend to appear earlier in each shuffled cycle
  #
  # recency_cutoff_years: Photos older than this have equal (minimum) weight
  #   - 5.0 = photos from 5+ years ago are weighted equally
  #   - 1.0 = only last year's photos get boosted
  #   - 10.0 = gradual decay over a decade
  recency_cutoff_years: 5.0

  # recency_min_weight: Weight for photos at/beyond the cutoff age
  #   - 0.33 = old photos are 1/3 as likely to appear early as new photos
  #   - 0.1 = old photos are 1/10 as likely (strong recency bias)
  #   - 1.0 = no recency bias (equivalent to "random")
  recency_min_weight: 0.33

# ------------------------------------------------------------
# Scaling and Cropping - How photos fill the screen
# ------------------------------------------------------------
scaling:
  # Scaling mode determines how photos fit the screen:
  #   "fill"     - Scale to fill entire screen, crop excess (no black bars)
  #   "fit"      - Scale to fit within screen, may have black bars
  #   "balanced" - Crop up to max_crop_percent, then show bars for the rest
  #                (good compromise between fill and fit)
  #   "stretch"  - Stretch to fill (distorts aspect ratio - not recommended)
  mode: "fill"

  # For "balanced" mode: maximum percentage of image that can be cropped (0-50)
  # Lower values = more bars but less cropping, higher = more cropping
  # Example: 15 means crop up to 15% before showing bars
  max_crop_percent: 15

  # Background color for letterbox/pillarbox bars (fit and balanced modes)
  # RGB color [R, G, B] where each value is 0-255
  background_color: [0, 0, 0]      # Black bars (default)
  # background_color: [32, 32, 32]  # Dark gray bars

  # Smart cropping (applies to fill and balanced modes)
  # When enabled, uses intelligent algorithms to find the best crop region
  # Tradeoff: Enabled = better framing but slightly slower image processing
  smart_crop: true

  # Smart crop method - which algorithm to use for finding crop regions
  # Options:
  #   "face"     - Use face detection (best for photos with people)
  #   "saliency" - Use saliency detection (finds visually interesting regions)
  #   "hybrid"   - Try face detection first, fall back to saliency if no faces
  #
  # Tradeoff:
  #   - "face": Fast, works great for portraits/group photos, ignores non-face subjects
  #   - "saliency": Slower (~200ms/photo), works for any subject (landscapes, objects)
  #   - "hybrid": Most versatile but slowest (tries both methods)
  smart_crop_method: "face"

  # Face detection settings (used when smart_crop_method is "face" or "hybrid")
  # Uses YuNet neural network model for accurate detection
  #
  # Tradeoff:
  #   - true: Faces stay visible in cropped photos, but adds ~50-100ms
  #     processing time per photo and uses more CPU
  #   - false: Faster processing, but faces may be partially cropped
  face_detection: true

  # Where to position detected faces after cropping
  # Options:
  #   "center"         - Center faces in the frame
  #   "rule_of_thirds" - Position faces at rule-of-thirds intersection points
  #   "top_third"      - Position faces in upper third (good for portraits)
  face_position: "center"

  # Fallback crop position when no faces/salient regions are detected
  # Options: "center", "top", "bottom"
  fallback_crop: "center"

  # Crop bias - when cropping is needed, which direction to prefer
  # Options:
  #   "center" - Crop equally from both sides
  #   "top"    - Preserve top of image, crop from bottom (good for landscapes with sky)
  #   "bottom" - Preserve bottom of image, crop from top
  # Only applies when smart cropping doesn't find a specific region to preserve
  crop_bias: "center"

  # Saliency detection settings (used when smart_crop_method is "saliency" or "hybrid")
  # Saliency detection uses a neural network (U2-Net) to find visually important regions
  #
  # saliency_threshold: Minimum saliency score to consider a pixel "important" (0.0-1.0)
  #   - 0.3 = include moderately salient regions (more inclusive)
  #   - 0.5 = only highly salient regions (more selective)
  #   - Lower values = larger "important" regions, more context preserved
  saliency_threshold: 0.3

  # saliency_coverage: What fraction of the salient region must fit in the crop (0.0-1.0)
  #   - 0.9 = crop must contain 90% of the detected salient area
  #   - 0.7 = more aggressive cropping allowed, may cut some salient edges
  #   - Higher values = safer crops but may need more black bars
  saliency_coverage: 0.9

# ------------------------------------------------------------
# Ken Burns Effect - Slow zoom/pan during photo display
# ------------------------------------------------------------
# The Ken Burns effect adds subtle motion to still photos by slowly
# zooming and panning. This creates a more engaging viewing experience.
#
# Tradeoff: Enabled = more cinematic feel but uses slightly more CPU;
# Disabled = static display, lower power consumption
ken_burns:
  enabled: true

  # Zoom range: [minimum, maximum]
  # 1.0 = no zoom, 1.15 = 15% zoom in
  # The effect will zoom between these values
  # Tradeoff: Larger range = more dramatic effect but may crop important edges
  zoom_range: [1.0, 1.15]

  # Pan speed as fraction of image dimension per second
  # 0.02 = move 2% of image width/height per second
  # Tradeoff: Higher = more noticeable motion; Lower = subtler, calmer effect
  pan_speed: 0.02

  # Randomize zoom direction and pan path
  # true = varied, unpredictable motion
  # false = consistent, repeating patterns
  randomize: true

# ------------------------------------------------------------
# Overlay Settings - Photo date and caption display
# ------------------------------------------------------------
# Shows photo information overlaid on the image during display
overlay:
  enabled: true

  # What information to show
  show_date: true                  # Photo date from EXIF/metadata
  show_caption: true               # Description/caption if available

  # Date formatting (Python strftime format)
  # Examples:
  #   "%B %d, %Y"    -> "January 15, 2024"
  #   "%Y-%m-%d"     -> "2024-01-15"
  #   "%d/%m/%Y"     -> "15/01/2024"
  #   "%b %d, %Y"    -> "Jan 15, 2024"
  date_format: "%B %d, %Y"

  # Date source preference - which date to display when multiple are available
  # Options:
  #   "exif_first"   - Use EXIF date if available, fall back to Google Photos date (default)
  #   "google_first" - Use Google Photos date if available, fall back to EXIF date
  #   "exif_only"    - Only show EXIF date, never Google Photos date
  #   "google_only"  - Only show Google Photos date, never EXIF date
  #
  # Note:
  #   - EXIF date: Embedded in photo file metadata (when photo was actually taken)
  #   - Google date: Scraped from Google Photos album (may be upload date or edited date)
  #   - EXIF is usually more accurate for "when was this photo taken"
  date_source: "exif_first"

  # Overlay position on screen
  # Options: bottom_left, bottom_right, top_left, top_right
  position: "bottom_left"

  # Text appearance
  font_size: 24                    # Font size in pixels
  font_color: [255, 255, 255]      # RGB color [R, G, B]
                                   # [255, 255, 255] = white
                                   # [255, 255, 0] = yellow

  # Background behind text (improves readability)
  background_color: [0, 0, 0, 128] # RGBA [R, G, B, Alpha]
                                   # [0, 0, 0, 128] = semi-transparent black
                                   # Alpha: 0 = transparent, 255 = opaque

  padding: 20                      # Distance from screen edge in pixels
  max_caption_length: 200          # Truncate long captions (0 = no limit)

  # Caption source priorities (lower number = higher priority)
  # Available sources:
  #   google_caption   - Description from Google Photos (user-entered)
  #   embedded_caption - Caption from EXIF/IPTC metadata in photo file
  #   google_location  - Location from Google Photos info panel
  #   exif_location    - Reverse-geocoded location from EXIF GPS coordinates
  #
  # Only include sources you want to display. Omit a source to never show it.
  # Duplicate values (e.g., same caption in Google and EXIF) are automatically skipped.
  caption_sources:
    google_caption: 1
    embedded_caption: 2
    google_location: 3
    exif_location: 4

  # How many caption sources to show (after deduplication)
  # 1 = only highest priority source with data
  # 2 = top two sources (e.g., caption + location)
  max_caption_sources: 1

  # Separator between multiple caption sources (when max_caption_sources > 1)
  caption_separator: " — "

# ------------------------------------------------------------
# Schedule - When to display slideshow vs off-hours mode
# ------------------------------------------------------------
# Configure when the slideshow runs. Outside scheduled hours,
# the display will either power off or show a clock.
schedule:
  enabled: true

  # What to do outside scheduled hours
  # Options:
  #   "black" - Power off the display (saves electricity)
  #             Uses DDC/CI for monitors or HDMI-CEC for TVs
  #             Falls back to black screen if neither available
  #   "clock" - Keep display on and show a simple clock
  #
  # Tradeoff:
  #   - "black": Saves power, extends display lifespan, but display takes
  #     a few seconds to wake up when schedule resumes
  #   - "clock": Always-on display, instant slideshow start, but uses more power
  off_hours_mode: "black"

  # Weekday schedule (Monday through Friday)
  weekday:
    start_time: "07:00"            # 24-hour format HH:MM
    end_time: "22:00"

  # Weekend schedule (Saturday and Sunday)
  weekend:
    start_time: "08:00"            # Sleep in on weekends!
    end_time: "23:00"              # Stay up later

  # Optional: Override schedule for specific days
  # Uncomment and modify as needed
  # overrides:
  #   monday:
  #     start_time: "06:00"        # Early meetings on Monday
  #     end_time: "21:00"
  #   friday:
  #     start_time: "07:00"
  #     end_time: "23:30"          # Friday night!
  #   saturday:
  #     start_time: "09:00"        # Extra sleep on Saturday
  #     end_time: "00:00"          # Midnight (use 00:00 for midnight)

# ------------------------------------------------------------
# Cache Settings - Local storage for photos/videos
# ------------------------------------------------------------
cache:
  # Where to store downloaded photos and videos
  directory: "/var/lib/photoloop/cache"

  # Maximum cache size in megabytes
  # When exceeded, oldest photos (by last_seen date) are removed
  #
  # Deletion behavior:
  #   - Photos removed from albums are "soft deleted" (excluded from slideshow)
  #   - Actual files remain on disk until cache exceeds max_size_mb
  #   - When limit is exceeded, soft-deleted files are removed first
  #   - Local directory photos are referenced in-place (not copied to cache)
  #
  # Sizing guide:
  #   - 1080p photos: ~2-5 MB each → 1000 MB ≈ 200-500 photos
  #   - 4K photos: ~8-15 MB each → 1000 MB ≈ 65-125 photos
  #   - With full_resolution: true, photos can be 10-20+ MB each
  #
  # Tradeoff: Larger cache = more photos available offline,
  # but uses more SD card space (check with 'df -h')
  max_size_mb: 1000

# ------------------------------------------------------------
# Web Interface - Remote configuration via browser
# ------------------------------------------------------------
# Access the dashboard at: http://<hostname>.local:<port>
# Example: http://photopi1.local:8080
web:
  enabled: true
  port: 8080                       # Web interface port (default: 8080)
  host: "0.0.0.0"                  # "0.0.0.0" = accessible from network
                                   # "127.0.0.1" = localhost only

  # NOTE: If you change the port above, also update the mDNS service file
  # so network discovery advertises the correct port:
  #   sudo nano /etc/avahi/services/photoloop.service
  # Change <port>8080</port> to match your new port, then restart avahi:
  #   sudo systemctl restart avahi-daemon

# ============================================================
# Quick Start Guide
# ============================================================
#
# 1. Replace the album URL above with your public Google Photos album
# 2. Run: photoloop sync (to download photos)
# 3. Run: photoloop start (or let systemd start it)
# 4. Access web interface: http://<pi-ip>:8080
#
# Commands:
#   photoloop status  - Show current state
#   photoloop start   - Force slideshow on
#   photoloop stop    - Force slideshow off
#   photoloop resume  - Follow schedule
#   photoloop sync    - Download new photos
#   photoloop reload  - Reload this config
#
# Service control:
#   sudo systemctl start photoloop
#   sudo systemctl stop photoloop
#   sudo systemctl restart photoloop
#   sudo systemctl status photoloop
#
# ============================================================
